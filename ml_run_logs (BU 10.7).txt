/Users/shachar.katz/opt/anaconda3/envs/march222/bin/python /Users/shachar.katz/Documents/TechnionAAA/sem7/Bio/brains_v2/processing_pipeline.py
2022-07-09 21:29:35.10: *********************************** Start pipeline run ***********************************
2022-07-09 21:29:35.10: status: check_files_and_folder_for_complete_run: check missing default files and folder...
did not found folder named: plots_folder1/part2plots_folder1/testing2_out
Found there are some missing files and folders! better check them before running...
Warning: there are some missing files and folders:
1) plots_folder1/part2plots_folder1/testing2_out (folder)
Warning: we are suggesting to create those files and folder before continuing
2022-07-09 21:29:35.41: start features_to_csv
2022-07-09 21:29:35.60: start run_func_for_all with raw_mtx_to_csv
status: start processing ./raw_data/35_1_matrix.mtx
status: reached line #0
status: reached line #2000000
status: reached line #4000000
status: reached line #6000000
status: reached line #8000000
status: reached line #10000000
status: reached line #12000000
status: finish processing mtx file. creating csv file
status: created the file "./csv_data2/35_1_matrix.csv"
status: start processing ./raw_data/35_2_matrix.mtx
status: reached line #0
status: reached line #2000000
status: reached line #4000000
status: reached line #6000000
status: reached line #8000000
status: reached line #10000000
status: reached line #12000000
status: reached line #14000000
status: finish processing mtx file. creating csv file
status: created the file "./csv_data2/35_2_matrix.csv"
status: start processing ./raw_data/36_1_matrix.mtx
status: reached line #0
status: reached line #2000000
status: reached line #4000000
status: reached line #6000000
status: reached line #8000000
status: reached line #10000000
status: reached line #12000000
status: finish processing mtx file. creating csv file
status: created the file "./csv_data2/36_1_matrix.csv"
status: start processing ./raw_data/36_2_matrix.mtx
status: reached line #0
status: reached line #2000000
status: reached line #4000000
status: reached line #6000000
status: reached line #8000000
status: reached line #10000000
status: finish processing mtx file. creating csv file
status: created the file "./csv_data2/36_2_matrix.csv"
status: start processing ./raw_data/37_1_matrix.mtx
status: reached line #0
status: reached line #2000000
status: reached line #4000000
status: reached line #6000000
status: reached line #8000000
status: reached line #10000000
status: finish processing mtx file. creating csv file
status: created the file "./csv_data2/37_1_matrix.csv"
status: start processing ./raw_data/37_2_matrix.mtx
status: reached line #0
status: reached line #2000000
status: reached line #4000000
status: reached line #6000000
status: reached line #8000000
status: reached line #10000000
status: reached line #12000000
status: finish processing mtx file. creating csv file
status: created the file "./csv_data2/37_2_matrix.csv"
status: start processing ./raw_data/38_1_matrix.mtx
status: reached line #0
status: reached line #2000000
status: reached line #4000000
status: reached line #6000000
status: reached line #8000000
status: reached line #10000000
status: reached line #12000000
status: finish processing mtx file. creating csv file
status: created the file "./csv_data2/38_1_matrix.csv"
status: start processing ./raw_data/38_2_matrix.mtx
status: reached line #0
status: reached line #2000000
status: reached line #4000000
status: reached line #6000000
status: reached line #8000000
status: finish processing mtx file. creating csv file
status: created the file "./csv_data2/38_2_matrix.csv"
status: start processing ./raw_data/51_1_matrix.mtx
status: reached line #0
status: reached line #2000000
status: reached line #4000000
status: reached line #6000000
status: reached line #8000000
status: reached line #10000000
status: reached line #12000000
status: reached line #14000000
status: reached line #16000000
status: finish processing mtx file. creating csv file
status: created the file "./csv_data2/51_1_matrix.csv"
status: start processing ./raw_data/51_2_matrix.mtx
status: reached line #0
status: reached line #2000000
status: reached line #4000000
status: reached line #6000000
status: reached line #8000000
status: reached line #10000000
status: reached line #12000000
status: reached line #14000000
status: finish processing mtx file. creating csv file
status: created the file "./csv_data2/51_2_matrix.csv"
status: start processing ./raw_data/51_3_matrix.mtx
status: reached line #0
status: reached line #2000000
status: reached line #4000000
status: reached line #6000000
status: reached line #8000000
status: finish processing mtx file. creating csv file
status: created the file "./csv_data2/51_3_matrix.csv"
status: start processing ./raw_data/51_4_matrix.mtx
status: reached line #0
status: reached line #2000000
status: reached line #4000000
status: reached line #6000000
status: reached line #8000000
status: finish processing mtx file. creating csv file
status: created the file "./csv_data2/51_4_matrix.csv"
status: start processing ./raw_data/52_1_matrix.mtx
status: reached line #0
status: reached line #2000000
status: reached line #4000000
status: reached line #6000000
status: reached line #8000000
status: reached line #10000000
status: finish processing mtx file. creating csv file
status: created the file "./csv_data2/52_1_matrix.csv"
status: start processing ./raw_data/52_2_matrix.mtx
status: reached line #0
status: reached line #2000000
status: reached line #4000000
status: reached line #6000000
status: reached line #8000000
status: reached line #10000000
status: reached line #12000000
status: finish processing mtx file. creating csv file
status: created the file "./csv_data2/52_2_matrix.csv"
status: start processing ./raw_data/52_3_matrix.mtx
status: reached line #0
status: reached line #2000000
status: reached line #4000000
status: reached line #6000000
status: reached line #8000000
status: reached line #10000000
status: finish processing mtx file. creating csv file
status: created the file "./csv_data2/52_3_matrix.csv"
status: start processing ./raw_data/52_4_matrix.mtx
status: reached line #0
status: reached line #2000000
status: reached line #4000000
status: reached line #6000000
status: reached line #8000000
status: reached line #10000000
status: finish processing mtx file. creating csv file
status: created the file "./csv_data2/52_4_matrix.csv"
2022-07-09 21:39:51.33: finish run_func_for_all with raw_mtx_to_csv
2022-07-09 21:39:51.33: start prepare_metadata_single_files
2022-07-09 21:39:52.29: start run_func_for_all with filter_cols
status: start filtering ./csv_data2/35_1_matrix.csv by col sum < 3000 and col number of different gens < 2500
2022-07-09 21:40:16.84: filter_by_min_sum: ./csv_data2/35_1_matrix.csv: Note: started with 5238 cols, after filtering left with 2436 (filtered 2802 cols)
status: finish filtering ./csv_data2/35_1_matrix.csv. result saved to ./filtered_data3/35_1_matrix_filtered.csv
status: start filtering ./csv_data2/35_2_matrix.csv by col sum < 3000 and col number of different gens < 2500
2022-07-09 21:40:42.98: filter_by_min_sum: ./csv_data2/35_2_matrix.csv: Note: started with 5029 cols, after filtering left with 2849 (filtered 2180 cols)
status: finish filtering ./csv_data2/35_2_matrix.csv. result saved to ./filtered_data3/35_2_matrix_filtered.csv
status: start filtering ./csv_data2/36_1_matrix.csv by col sum < 3000 and col number of different gens < 2500
2022-07-09 21:41:04.95: filter_by_min_sum: ./csv_data2/36_1_matrix.csv: Note: started with 4479 cols, after filtering left with 2287 (filtered 2192 cols)
status: finish filtering ./csv_data2/36_1_matrix.csv. result saved to ./filtered_data3/36_1_matrix_filtered.csv
status: start filtering ./csv_data2/36_2_matrix.csv by col sum < 3000 and col number of different gens < 2500
2022-07-09 21:41:26.43: filter_by_min_sum: ./csv_data2/36_2_matrix.csv: Note: started with 4441 cols, after filtering left with 2281 (filtered 2160 cols)
status: finish filtering ./csv_data2/36_2_matrix.csv. result saved to ./filtered_data3/36_2_matrix_filtered.csv
status: start filtering ./csv_data2/37_1_matrix.csv by col sum < 3000 and col number of different gens < 2500
2022-07-09 21:41:44.90: filter_by_min_sum: ./csv_data2/37_1_matrix.csv: Note: started with 4197 cols, after filtering left with 1879 (filtered 2318 cols)
status: finish filtering ./csv_data2/37_1_matrix.csv. result saved to ./filtered_data3/37_1_matrix_filtered.csv
status: start filtering ./csv_data2/37_2_matrix.csv by col sum < 3000 and col number of different gens < 2500
2022-07-09 21:42:10.57: filter_by_min_sum: ./csv_data2/37_2_matrix.csv: Note: started with 5564 cols, after filtering left with 2462 (filtered 3102 cols)
status: finish filtering ./csv_data2/37_2_matrix.csv. result saved to ./filtered_data3/37_2_matrix_filtered.csv
status: start filtering ./csv_data2/38_1_matrix.csv by col sum < 3000 and col number of different gens < 2500
2022-07-09 21:42:34.13: filter_by_min_sum: ./csv_data2/38_1_matrix.csv: Note: started with 4684 cols, after filtering left with 2588 (filtered 2096 cols)
status: finish filtering ./csv_data2/38_1_matrix.csv. result saved to ./filtered_data3/38_1_matrix_filtered.csv
status: start filtering ./csv_data2/38_2_matrix.csv by col sum < 3000 and col number of different gens < 2500
2022-07-09 21:42:48.09: filter_by_min_sum: ./csv_data2/38_2_matrix.csv: Note: started with 3919 cols, after filtering left with 1707 (filtered 2212 cols)
status: finish filtering ./csv_data2/38_2_matrix.csv. result saved to ./filtered_data3/38_2_matrix_filtered.csv
status: start filtering ./csv_data2/51_1_matrix.csv by col sum < 3000 and col number of different gens < 2500
2022-07-09 21:43:35.64: filter_by_min_sum: ./csv_data2/51_1_matrix.csv: Note: started with 8195 cols, after filtering left with 2871 (filtered 5324 cols)
status: finish filtering ./csv_data2/51_1_matrix.csv. result saved to ./filtered_data3/51_1_matrix_filtered.csv
status: start filtering ./csv_data2/51_2_matrix.csv by col sum < 3000 and col number of different gens < 2500
2022-07-09 21:44:01.81: filter_by_min_sum: ./csv_data2/51_2_matrix.csv: Note: started with 5009 cols, after filtering left with 2928 (filtered 2081 cols)
status: finish filtering ./csv_data2/51_2_matrix.csv. result saved to ./filtered_data3/51_2_matrix_filtered.csv
status: start filtering ./csv_data2/51_3_matrix.csv by col sum < 3000 and col number of different gens < 2500
2022-07-09 21:44:15.78: filter_by_min_sum: ./csv_data2/51_3_matrix.csv: Note: started with 3858 cols, after filtering left with 1762 (filtered 2096 cols)
status: finish filtering ./csv_data2/51_3_matrix.csv. result saved to ./filtered_data3/51_3_matrix_filtered.csv
status: start filtering ./csv_data2/51_4_matrix.csv by col sum < 3000 and col number of different gens < 2500
2022-07-09 21:44:34.95: filter_by_min_sum: ./csv_data2/51_4_matrix.csv: Note: started with 4458 cols, after filtering left with 1870 (filtered 2588 cols)
status: finish filtering ./csv_data2/51_4_matrix.csv. result saved to ./filtered_data3/51_4_matrix_filtered.csv
status: start filtering ./csv_data2/52_1_matrix.csv by col sum < 3000 and col number of different gens < 2500
2022-07-09 21:44:57.81: filter_by_min_sum: ./csv_data2/52_1_matrix.csv: Note: started with 5231 cols, after filtering left with 2196 (filtered 3035 cols)
status: finish filtering ./csv_data2/52_1_matrix.csv. result saved to ./filtered_data3/52_1_matrix_filtered.csv
status: start filtering ./csv_data2/52_2_matrix.csv by col sum < 3000 and col number of different gens < 2500
2022-07-09 21:45:24.40: filter_by_min_sum: ./csv_data2/52_2_matrix.csv: Note: started with 6364 cols, after filtering left with 2321 (filtered 4043 cols)
status: finish filtering ./csv_data2/52_2_matrix.csv. result saved to ./filtered_data3/52_2_matrix_filtered.csv
status: start filtering ./csv_data2/52_3_matrix.csv by col sum < 3000 and col number of different gens < 2500
2022-07-09 21:45:44.90: filter_by_min_sum: ./csv_data2/52_3_matrix.csv: Note: started with 4362 cols, after filtering left with 2194 (filtered 2168 cols)
status: finish filtering ./csv_data2/52_3_matrix.csv. result saved to ./filtered_data3/52_3_matrix_filtered.csv
status: start filtering ./csv_data2/52_4_matrix.csv by col sum < 3000 and col number of different gens < 2500
2022-07-09 21:46:06.23: filter_by_min_sum: ./csv_data2/52_4_matrix.csv: Note: started with 4585 cols, after filtering left with 2236 (filtered 2349 cols)
status: finish filtering ./csv_data2/52_4_matrix.csv. result saved to ./filtered_data3/52_4_matrix_filtered.csv
2022-07-09 21:46:06.24: finish run_func_for_all with filter_cols
2022-07-09 21:46:06.24: start filter_metadata_rows
status: start filtering ./csv_data2/38_1_metadata.csv
status: start filtering ./csv_data2/38_2_metadata.csv
status: start filtering ./csv_data2/36_1_metadata.csv
status: start filtering ./csv_data2/52_4_metadata.csv
status: start filtering ./csv_data2/36_2_metadata.csv
status: start filtering ./csv_data2/52_2_metadata.csv
status: start filtering ./csv_data2/52_3_metadata.csv
status: start filtering ./csv_data2/52_1_metadata.csv
status: start filtering ./csv_data2/51_1_metadata.csv
status: start filtering ./csv_data2/37_2_metadata.csv
status: start filtering ./csv_data2/37_1_metadata.csv
status: start filtering ./csv_data2/51_3_metadata.csv
status: start filtering ./csv_data2/51_2_metadata.csv
status: start filtering ./csv_data2/35_2_metadata.csv
status: start filtering ./csv_data2/51_4_metadata.csv
status: start filtering ./csv_data2/35_1_metadata.csv
2022-07-09 21:47:04.50: start print_hist_genes
start
iteration number: 0
iteration number: 1
iteration number: 2
iteration number: 3
iteration number: 4
iteration number: 5
iteration number: 6
iteration number: 7
iteration number: 8
iteration number: 9
iteration number: 10
iteration number: 11
iteration number: 12
iteration number: 13
iteration number: 14
iteration number: 15

2022-07-09 21:51:30.15: start print_pdf_mul
2022-07-09 21:53:31.79: start run_func_for_all with normalize_data
status: finish normalizing ./filtered_data3/35_1_matrix_filtered.csv. result saved to ./normalized_data4/35_1_matrix_normalized.csv
status: finish normalizing ./filtered_data3/35_2_matrix_filtered.csv. result saved to ./normalized_data4/35_2_matrix_normalized.csv
status: finish normalizing ./filtered_data3/36_1_matrix_filtered.csv. result saved to ./normalized_data4/36_1_matrix_normalized.csv
status: finish normalizing ./filtered_data3/36_2_matrix_filtered.csv. result saved to ./normalized_data4/36_2_matrix_normalized.csv
status: finish normalizing ./filtered_data3/37_1_matrix_filtered.csv. result saved to ./normalized_data4/37_1_matrix_normalized.csv
status: finish normalizing ./filtered_data3/37_2_matrix_filtered.csv. result saved to ./normalized_data4/37_2_matrix_normalized.csv
status: finish normalizing ./filtered_data3/38_1_matrix_filtered.csv. result saved to ./normalized_data4/38_1_matrix_normalized.csv
status: finish normalizing ./filtered_data3/38_2_matrix_filtered.csv. result saved to ./normalized_data4/38_2_matrix_normalized.csv
status: finish normalizing ./filtered_data3/51_1_matrix_filtered.csv. result saved to ./normalized_data4/51_1_matrix_normalized.csv
status: finish normalizing ./filtered_data3/51_2_matrix_filtered.csv. result saved to ./normalized_data4/51_2_matrix_normalized.csv
status: finish normalizing ./filtered_data3/51_3_matrix_filtered.csv. result saved to ./normalized_data4/51_3_matrix_normalized.csv
status: finish normalizing ./filtered_data3/51_4_matrix_filtered.csv. result saved to ./normalized_data4/51_4_matrix_normalized.csv
status: finish normalizing ./filtered_data3/52_1_matrix_filtered.csv. result saved to ./normalized_data4/52_1_matrix_normalized.csv
status: finish normalizing ./filtered_data3/52_2_matrix_filtered.csv. result saved to ./normalized_data4/52_2_matrix_normalized.csv
status: finish normalizing ./filtered_data3/52_3_matrix_filtered.csv. result saved to ./normalized_data4/52_3_matrix_normalized.csv
status: finish normalizing ./filtered_data3/52_4_matrix_filtered.csv. result saved to ./normalized_data4/52_4_matrix_normalized.csv
2022-07-09 22:01:58.35: finish run_func_for_all with normalize_data
2022-07-09 22:01:58.35: start stack_csv_together
status: stack_csv_together for ['35_1_matrix_normalized.csv', '35_2_matrix_normalized.csv', '36_1_matrix_normalized.csv', '36_2_matrix_normalized.csv', '37_1_matrix_normalized.csv', '37_2_matrix_normalized.csv', '38_1_matrix_normalized.csv', '38_2_matrix_normalized.csv', '51_1_matrix_normalized.csv', '51_2_matrix_normalized.csv', '51_3_matrix_normalized.csv', '51_4_matrix_normalized.csv', '52_1_matrix_normalized.csv', '52_2_matrix_normalized.csv', '52_3_matrix_normalized.csv', '52_4_matrix_normalized.csv']
[('35_1_matrix_normalized.csv', 1), ('35_2_matrix_normalized.csv', 2437), ('36_1_matrix_normalized.csv', 5286), ('36_2_matrix_normalized.csv', 7573), ('37_1_matrix_normalized.csv', 9854), ('37_2_matrix_normalized.csv', 11733), ('38_1_matrix_normalized.csv', 14195), ('38_2_matrix_normalized.csv', 16783), ('51_1_matrix_normalized.csv', 18490), ('51_2_matrix_normalized.csv', 21361), ('51_3_matrix_normalized.csv', 24289), ('51_4_matrix_normalized.csv', 26051), ('52_1_matrix_normalized.csv', 27921), ('52_2_matrix_normalized.csv', 30117), ('52_3_matrix_normalized.csv', 32438), ('52_4_matrix_normalized.csv', 34632)]
status: finish stack_csv_together. the new concat file called ./merged_data5/stacked_1.csv
status: merge_all_metadata for ['35_1_metadata_filtered.csv', '35_2_metadata_filtered.csv', '36_1_metadata_filtered.csv', '36_2_metadata_filtered.csv', '37_1_metadata_filtered.csv', '37_2_metadata_filtered.csv', '38_1_metadata_filtered.csv', '38_2_metadata_filtered.csv', '51_1_metadata_filtered.csv', '51_2_metadata_filtered.csv', '51_3_metadata_filtered.csv', '51_4_metadata_filtered.csv', '52_1_metadata_filtered.csv', '52_2_metadata_filtered.csv', '52_3_metadata_filtered.csv', '52_4_metadata_filtered.csv']
status: finish merge_all_metadata. the new concat file called ./merged_data5/all_samples_metadata.csv
Status: split_merged_into_M_F: start splitting the merged csv file into females and males csv
Females: ['35_1', '35_2', '38_1', '38_2', '51_1', '51_2', '52_1', '52_2']
Males: ['36_1', '36_2', '37_1', '37_2', '51_3', '51_4', '52_3', '52_4']
Status: finish loading data (its shape: (27998, 36867)). now filtering only males
Status: created male df (shape (27998, 16971)). saving it into ./merged_data5/stacked_M.csv
Status: now filtering only females
Status: created female df (shape (27998, 19896)). saving it into ./merged_data5/stacked_F.csv
Status: finish splitting the merged csv file into females and males csv
2022-07-09 22:40:55.12: plot_female_vs_male_mean: the 20 genes we found in this function are: ['Xist' 'Gm10076' 'Ddx3y' 'Eif2s3y' 'Tsix' 'Gm42418' 'Uba52' 'Rpl35'
 'Rpl38' 'Rps29' 'Rps28' 'Rpl37' 'Polr2l' 'Pdcd4' 'Rpl39' 'mt-Nd4l'
 'mt-Co1' 'Ecel1' 'Rps21' 'Rpl6']
2022-07-09 22:47:44.13: plot_female_vs_male_expression_fraction: the 20 genes we found in this function are: ['Xist' 'Ddx3y' 'Eif2s3y' 'Tsix' 'Gm10076' 'Kdm5d' 'Ccdc85b' 'Polr2l'
 'Uty' 'Uba52' 'Ecel1' 'Gm10073' 'Rbm3' 'Gstp1' 'PISD' 'Eif2s3x' 'Greb1'
 'Brinp2' 'Snhg6' 'Col25a1']
2022-07-09 22:47:44.14: start filter_common_and_rare_gens
df.shape (27998, 36867)
df.shape[0] 27998
df.shape[1] 36867
2022-07-09 23:02:12.39: filtered 10499 genes (original shape was (27998, 36867) and the update one is (17499, 36867)). filtered csv saved as ./merged_data5/stacked_2_v2.csv
2022-07-09 23:22:10.94: start calc_and_plot_cv. df original shape is (17499, 36867)
 
-0.4953 x + 0.7906
the 100 farthest genes in the cv plot are: 
['Hbb-bs' 'Oxt' 'Plp1' 'Hba-a1' 'Avp' 'Hba-a2' 'Hbb-bt' 'Ptgds' 'Mal'
 'Acta2' 'Gfap' 'Vip' 'Sst' 'Apoe' 'Cldn5' 'Myoc' 'Cnp' 'Cartpt' 'Flt1'
 'Cort' 'Ucn3' 'Mobp' 'Ccl4' 'Klf2' 'Tagln' 'Rgs5' 'Mag' 'Npy' 'Itm2a'
 'Tac2' 'Mbp' 'Cldn11' 'Aqp4' 'Top2a' 'Pltp' 'Ly6c1' 'Nts' 'Lyz2' 'Atp1a2'
 'Trf' 'Vtn' 'Dbi' 'Slco1a4' 'Tmem212' 'Ly6a' 'C1qa' 'Igfbp7' 'C1qb'
 'Cxcl12' 'Tm4sf1' 'Plac8' 'Ifitm3' 'Ccl3' 'Gal' 'Gpr17' 'Mog' 'Id3'
 'Sparc' 'Id1' 'H2-Aa' 'Ccl5' 'Gkn3' 'Cryab' 'Ctla2a' 'C1ql3' 'Apod'
 'Hspb1' 'Epas1' 'S100a3' 'Klf4' 'Ptprb' 'Tcf7l2' 'Mgp' 'Ube2c' 'C1qc'
 'Hexb' 'Cd74' 'Snca' 'Crip1' 'Tac1' 'Olig1' 'Cnr1' 'Opalin' 'Ndrg2' 'Ptn'
 'Sepp1' 'Bcas1' 'Ermn' 'Car2' 'Kif14' 'Gm44129' 'Fabp7' 'Tpm2' 'Cx3cr1'
 'Gad2' 'Fos' 'Myl9' 'Gatm' 'Plpp3' 'Atf3']
2022-07-09 23:22:55.43: calc_and_plot_cv: finished plotting mean as a function of cv for each gene
 The 100 genes we cleaned are ['Hbb-bs' 'Oxt' 'Plp1' 'Hba-a1' 'Avp' 'Hba-a2' 'Hbb-bt' 'Ptgds' 'Mal'
 'Acta2' 'Gfap' 'Vip' 'Sst' 'Apoe' 'Cldn5' 'Myoc' 'Cnp' 'Cartpt' 'Flt1'
 'Cort' 'Ucn3' 'Mobp' 'Ccl4' 'Klf2' 'Tagln' 'Rgs5' 'Mag' 'Npy' 'Itm2a'
 'Tac2' 'Mbp' 'Cldn11' 'Aqp4' 'Top2a' 'Pltp' 'Ly6c1' 'Nts' 'Lyz2' 'Atp1a2'
 'Trf' 'Vtn' 'Dbi' 'Slco1a4' 'Tmem212' 'Ly6a' 'C1qa' 'Igfbp7' 'C1qb'
 'Cxcl12' 'Tm4sf1' 'Plac8' 'Ifitm3' 'Ccl3' 'Gal' 'Gpr17' 'Mog' 'Id3'
 'Sparc' 'Id1' 'H2-Aa' 'Ccl5' 'Gkn3' 'Cryab' 'Ctla2a' 'C1ql3' 'Apod'
 'Hspb1' 'Epas1' 'S100a3' 'Klf4' 'Ptprb' 'Tcf7l2' 'Mgp' 'Ube2c' 'C1qc'
 'Hexb' 'Cd74' 'Snca' 'Crip1' 'Tac1' 'Olig1' 'Cnr1' 'Opalin' 'Ndrg2' 'Ptn'
 'Sepp1' 'Bcas1' 'Ermn' 'Car2' 'Kif14' 'Gm44129' 'Fabp7' 'Tpm2' 'Cx3cr1'
 'Gad2' 'Fos' 'Myl9' 'Gatm' 'Plpp3' 'Atf3']
Found knee point (closest to the origin) at (0.10312783318223027, 0.12738283714918916)
genes_threshold is 454
Status: removing rows (gens) which their distance from their CV point to the fit-line is greater then the threshold=0.1274
Also manually removing ['Xist', 'Tsix', 'Eif2s3y', 'Ddx3y', 'Uty', 'Kdm5d']
That removed 17045 genes. The new csv file saved as ./merged_data5/stacked_3_v2.csv
We were left with 454 genes.
status: finish calc_and_plot_cv. the new df shape is (454, 36867)
2022-07-09 23:23:29.61: pca_norm_knee: starting. original data shape is (454, 36867) (we Transpose this in a moment)
explain:
 [1.00000000e+00 3.31005234e-01 1.68006934e-01 1.48051219e-01
 1.10801071e-01 8.78608757e-02 8.47028764e-02 5.83016231e-02
 5.58170855e-02 5.26180488e-02 4.19286059e-02 3.81575599e-02
 3.33576239e-02 3.15194772e-02 2.94717871e-02 2.80404372e-02
 2.56964843e-02 2.48069119e-02 2.30627700e-02 2.23701215e-02
 2.05946961e-02 2.00451366e-02 1.93368597e-02 1.91868321e-02
 1.84569045e-02 1.75939994e-02 1.69544244e-02 1.66656750e-02
 1.63732473e-02 1.62450388e-02 1.58500891e-02 1.50170082e-02
 1.47257558e-02 1.40940217e-02 1.36669675e-02 1.34056138e-02
 1.32749341e-02 1.30210158e-02 1.28251783e-02 1.27362611e-02
 1.21995561e-02 1.21330086e-02 1.20246367e-02 1.18913045e-02
 1.17027886e-02 1.16148534e-02 1.15574145e-02 1.13843136e-02
 1.12564413e-02 1.11495878e-02 1.10805736e-02 1.10607514e-02
 1.09960237e-02 1.08463077e-02 1.07969836e-02 1.07495463e-02
 1.07164581e-02 1.06657967e-02 1.05927401e-02 1.05707798e-02
 1.05561658e-02 1.04807214e-02 1.04649483e-02 1.04260272e-02
 1.04150272e-02 1.03732784e-02 1.03491256e-02 1.03276039e-02
 1.02919744e-02 1.02701556e-02 1.02137232e-02 1.02009944e-02
 1.01596293e-02 1.01232726e-02 1.00843000e-02 1.00802304e-02
 1.00559197e-02 1.00346838e-02 9.98365028e-03 9.93709116e-03
 9.93175706e-03 9.88445061e-03 9.87602821e-03 9.85158353e-03
 9.77131170e-03 9.71952783e-03 9.67941555e-03 9.65234698e-03
 9.57176132e-03 9.52515512e-03 9.48752610e-03 9.46853079e-03
 9.34237365e-03 9.32308719e-03 9.19448217e-03 9.09689676e-03
 8.97777641e-03 8.94769454e-03 8.86526703e-03 8.81269045e-03
 8.71046010e-03 8.62429614e-03 8.59921654e-03 8.58189433e-03
 8.52200694e-03 8.47520435e-03 8.42186545e-03 8.30962643e-03
 8.22982878e-03 8.17517175e-03 8.14065491e-03 8.13635241e-03
 8.02750319e-03 7.96182655e-03 7.94268516e-03 7.90373179e-03
 7.81116078e-03 7.72923695e-03 7.71280323e-03 7.66209294e-03
 7.59486649e-03 7.57560618e-03 7.55750952e-03 7.49293471e-03
 7.39079130e-03 7.36599196e-03 7.34106259e-03 7.32143226e-03
 7.25450139e-03 7.22167675e-03 7.19882509e-03 7.15829743e-03
 7.08165433e-03 7.03001748e-03 6.99356027e-03 6.95521090e-03
 6.90954715e-03 6.87654440e-03 6.84070761e-03 6.83287423e-03
 6.75119040e-03 6.72531164e-03 6.70110696e-03 6.63804797e-03
 6.59445129e-03 6.54667081e-03 6.52377259e-03 6.47218115e-03
 6.44210014e-03 6.43841195e-03 6.38448205e-03 6.35064486e-03
 6.33820946e-03 6.30194317e-03 6.27635215e-03 6.25136524e-03
 6.20093969e-03 6.18188354e-03 6.13863524e-03 6.10554949e-03
 6.06451402e-03 6.03261763e-03 6.01980888e-03 5.98295160e-03
 5.95884143e-03 5.91423694e-03 5.89344918e-03 5.87612815e-03
 5.84304263e-03 5.82500443e-03 5.76853605e-03 5.75844611e-03
 5.74911051e-03 5.70751714e-03 5.67666699e-03 5.63546182e-03
 5.62128716e-03 5.61603548e-03 5.58683334e-03 5.57621235e-03
 5.55911811e-03 5.53967378e-03 5.50428361e-03 5.46727816e-03
 5.45763872e-03 5.38998014e-03 5.38759086e-03 5.36199985e-03
 5.34407035e-03 5.33066868e-03 5.30111670e-03 5.27552247e-03
 5.26298690e-03 5.25103676e-03 5.23346391e-03 5.21635233e-03
 5.19252687e-03 5.14812949e-03 5.13710755e-03 5.10987451e-03
 5.08354175e-03 5.07744623e-03 5.05661932e-03 5.02539514e-03
 5.01135937e-03 4.98127826e-03 4.97463085e-03 4.95670729e-03
 4.93089937e-03 4.90283863e-03 4.88503272e-03 4.86121558e-03
 4.84693801e-03 4.82785032e-03 4.81968332e-03 4.79567115e-03
 4.76978497e-03 4.74485526e-03 4.73027723e-03 4.70180618e-03
 4.69454390e-03 4.65823846e-03 4.63728519e-03 4.62289662e-03
 4.57344182e-03 4.54995391e-03 4.52978594e-03 4.50549710e-03
 4.48147568e-03 4.45646420e-03 4.42574795e-03 4.41440538e-03
 4.37391908e-03 4.36349939e-03 4.33919729e-03 4.29971226e-03
 4.27858771e-03 4.25202796e-03 4.24722359e-03 4.21974815e-03
 4.19913912e-03 4.19595590e-03 4.17673780e-03 4.16342119e-03
 4.13712723e-03 4.12714748e-03 4.10602669e-03 4.08859377e-03
 4.04463437e-03 4.04025230e-03 4.03493010e-03 4.00589219e-03
 3.97781175e-03 3.95976096e-03 3.95134710e-03 3.93581496e-03
 3.92624129e-03 3.90626159e-03 3.89646673e-03 3.88665304e-03
 3.85534278e-03 3.81202869e-03 3.80764690e-03 3.79950896e-03
 3.79008250e-03 3.76452919e-03 3.75412876e-03 3.73932022e-03
 3.72473945e-03 3.69799476e-03 3.69194001e-03 3.67472729e-03
 3.65689846e-03 3.63047051e-03 3.62388736e-03 3.59259431e-03
 3.58237265e-03 3.55700192e-03 3.54626670e-03 3.53601793e-03
 3.50287204e-03 3.48863581e-03 3.46860925e-03 3.45748406e-03
 3.44644417e-03 3.42196730e-03 3.40230361e-03 3.39117480e-03
 3.37859900e-03 3.35653803e-03 3.32455591e-03 3.31592565e-03
 3.30264938e-03 3.28695993e-03 3.26706711e-03 3.25032544e-03
 3.22226721e-03 3.20412972e-03 3.17115937e-03 3.16819916e-03
 3.14549791e-03 3.13485648e-03 3.12120812e-03 3.09984091e-03
 3.09446230e-03 3.06919314e-03 3.03737718e-03 3.01870820e-03
 3.00189357e-03 2.99062031e-03 2.97861143e-03 2.95994406e-03
 2.93919270e-03 2.93002366e-03 2.90875590e-03 2.90437321e-03
 2.87516974e-03 2.84233697e-03 2.83305633e-03 2.80112126e-03
 2.78257948e-03 2.77624945e-03 2.76975713e-03 2.74472936e-03
 2.73858307e-03 2.70121341e-03 2.68438560e-03 2.64246212e-03
 2.62598214e-03 2.61038670e-03 2.60296820e-03 2.59330797e-03
 2.56927009e-03 2.55448169e-03 2.54804445e-03 2.51648375e-03
 2.51255932e-03 2.46222053e-03 2.45355742e-03 2.43501853e-03
 2.41085754e-03 2.39019306e-03 2.37404480e-03 2.37101257e-03
 2.34371951e-03 2.32464627e-03 2.31082289e-03 2.29710233e-03
 2.27658706e-03 2.26388036e-03 2.23130810e-03 2.20465234e-03
 2.19207342e-03 2.17471537e-03 2.16000233e-03 2.14149083e-03
 2.12764205e-03 2.10749327e-03 2.10239476e-03 2.07846550e-03
 2.06215084e-03 2.03381740e-03 1.98678454e-03 1.96853321e-03
 1.95674485e-03 1.92963967e-03 1.92522281e-03 1.91543870e-03
 1.88373189e-03 1.86711304e-03 1.85867032e-03 1.83919482e-03
 1.83477934e-03 1.82832130e-03 1.79111616e-03 1.77259085e-03
 1.75759483e-03 1.73860977e-03 1.72102622e-03 1.71635554e-03
 1.69178233e-03 1.66711622e-03 1.65130108e-03 1.64183326e-03
 1.61656890e-03 1.58377147e-03 1.58274048e-03 1.56393272e-03
 1.53675888e-03 1.51553786e-03 1.50315212e-03 1.48324293e-03
 1.46839909e-03 1.45767267e-03 1.42789081e-03 1.42733292e-03
 1.41538034e-03 1.39770317e-03 1.38736290e-03 1.37842049e-03
 1.35550843e-03 1.33912168e-03 1.32941070e-03 1.31865156e-03
 1.28439296e-03 1.25887367e-03 1.23432096e-03 1.22251956e-03
 1.20969506e-03 1.20539734e-03 1.19065334e-03 1.17834687e-03
 1.14630563e-03 1.14084126e-03 1.12723838e-03 1.09365242e-03
 1.06499027e-03 1.02061151e-03 1.01543034e-03 9.99007064e-04
 9.75549799e-04 9.30874554e-04 9.19355533e-04 8.96249891e-04
 8.68642833e-04 8.46375109e-04 8.38712485e-04 8.13763640e-04
 8.04345794e-04 7.77999852e-04 7.49392727e-04 7.24380755e-04
 7.03480757e-04 6.38567027e-04 6.30933512e-04 5.95844216e-04
 5.77166971e-04 5.58359046e-04 5.35367662e-04 5.29315758e-04
 5.06672570e-04 4.80386893e-04 4.24848175e-04 4.15257206e-04
 3.98782437e-04 3.32110391e-04 2.91929960e-04 2.64794023e-04
 2.10832547e-04 1.53145677e-04 1.16653850e-04 1.12686531e-04
 9.93351969e-05 0.00000000e+00]
knee_point: 0.033357623891096 . coordinates: (0.026490066225165563, 0.033357623891096)
Now PCA with 13. explain now is:
 [92.64507325 30.6979912  15.60479529 13.75695077 10.30768915  8.1834899
  7.89106782  5.44638402  5.21632213  4.92009366  3.93027978  3.5810213
  3.13585213]
notice those are just the top 13 for the prev PCA explain we plot
2022-07-09 23:23:33.76: finish PCA. left with 13 values. current data shape is (36867, 13) (Transposed). saved to ./merged_data5/pca4.csv
2022-07-09 23:23:33.76: start tSNE
[t-SNE] Computing 181 nearest neighbors...
[t-SNE] Indexed 36867 samples in 0.000s...
[t-SNE] Computed neighbors for 36867 samples in 26.911s...
[t-SNE] Computed conditional probabilities for sample 1000 / 36867
[t-SNE] Computed conditional probabilities for sample 2000 / 36867
[t-SNE] Computed conditional probabilities for sample 3000 / 36867
[t-SNE] Computed conditional probabilities for sample 4000 / 36867
[t-SNE] Computed conditional probabilities for sample 5000 / 36867
[t-SNE] Computed conditional probabilities for sample 6000 / 36867
[t-SNE] Computed conditional probabilities for sample 7000 / 36867
[t-SNE] Computed conditional probabilities for sample 8000 / 36867
[t-SNE] Computed conditional probabilities for sample 9000 / 36867
[t-SNE] Computed conditional probabilities for sample 10000 / 36867
[t-SNE] Computed conditional probabilities for sample 11000 / 36867
[t-SNE] Computed conditional probabilities for sample 12000 / 36867
[t-SNE] Computed conditional probabilities for sample 13000 / 36867
[t-SNE] Computed conditional probabilities for sample 14000 / 36867
[t-SNE] Computed conditional probabilities for sample 15000 / 36867
[t-SNE] Computed conditional probabilities for sample 16000 / 36867
[t-SNE] Computed conditional probabilities for sample 17000 / 36867
[t-SNE] Computed conditional probabilities for sample 18000 / 36867
[t-SNE] Computed conditional probabilities for sample 19000 / 36867
[t-SNE] Computed conditional probabilities for sample 20000 / 36867
[t-SNE] Computed conditional probabilities for sample 21000 / 36867
[t-SNE] Computed conditional probabilities for sample 22000 / 36867
[t-SNE] Computed conditional probabilities for sample 23000 / 36867
[t-SNE] Computed conditional probabilities for sample 24000 / 36867
[t-SNE] Computed conditional probabilities for sample 25000 / 36867
[t-SNE] Computed conditional probabilities for sample 26000 / 36867
[t-SNE] Computed conditional probabilities for sample 27000 / 36867
[t-SNE] Computed conditional probabilities for sample 28000 / 36867
[t-SNE] Computed conditional probabilities for sample 29000 / 36867
[t-SNE] Computed conditional probabilities for sample 30000 / 36867
[t-SNE] Computed conditional probabilities for sample 31000 / 36867
[t-SNE] Computed conditional probabilities for sample 32000 / 36867
[t-SNE] Computed conditional probabilities for sample 33000 / 36867
[t-SNE] Computed conditional probabilities for sample 34000 / 36867
[t-SNE] Computed conditional probabilities for sample 35000 / 36867
[t-SNE] Computed conditional probabilities for sample 36000 / 36867
[t-SNE] Computed conditional probabilities for sample 36867 / 36867
[t-SNE] Mean sigma: 0.068073
[t-SNE] KL divergence after 250 iterations with early exaggeration: 160.875839
[t-SNE] KL divergence after 1500 iterations: 2.305054
2022-07-09 23:27:55.90: t-SNE done! Time elapsed: 260.0452778339386 seconds


2022-07-09 23:28:32.51: finish tSNE. new data with the two tSNE cols is in shape (36867, 18), saved to ./merged_data5/tsne.csv
2022-07-09 23:28:32.53: start DBScan_dynm_eps: finding the best eps with eps_prc=70 and k_neighbor=20

2022-07-09 23:32:37.28: finish DBScan_dynm_eps: found best eps is 1.4724638059244137. now moving to preforming DBScan
2022-07-09 23:32:37.28: start DBScan
Try using .loc[row_indexer,col_indexer] = value instead
  X['dbscan_labels'] = labels
2022-07-09 23:32:38.89: dbscan output: n_clusters_: 86 (aka dbscan_labels) and the n_noise_: 2629

2022-07-09 23:33:05.43: finish DBScan with eps 1.47246. new data with the labels from DBScan ("dbscan_labels", where -1 consider noise else the given label) is in shape (36867, 16). saved to ./clusttered_data6/dbscan.csv 
2022-07-09 23:33:06.15: starting sanity check: gene expression volume on T-SNE's scatter plot
!!! gen Snap25 (gen id 3364) is not in the stacked matrix data
gen id for Gad2 is 1868
gen id for Slc32a1 is 3682
gen id for Slc17a7 is 12665
gen id for Slc17a6 is 12788
gen id for Sst is 24074
gen id for Tac2 is 15165
gen id for Acta2 is 27614
gen id for Flt1 is 10037
gen id for Cldn5 is 23996
gen id for Aqp4 is 26583
gen id for Plp1 is 4923
2022-07-09 23:38:39.56: summarize:
	-created an image for the following gens [('Gad2', 1868), ('Slc32a1', 3682), ('Slc17a7', 12665), ('Slc17a6', 12788), ('Sst', 24074), ('Tac2', 15165), ('Acta2', 27614), ('Flt1', 10037), ('Cldn5', 23996), ('Aqp4', 26583), ('Plp1', 4923)].
	-Did not print for the following gens which did not found in data [('Snap25', 3364)]
2022-07-09 23:38:39.56: finished sanity check: plots saved in ./plots_folder1/part2
2022-07-09 23:38:39.59: #### starting linkage_pipeline ####
2022-07-09 23:38:39.59: starting avg_and_fraction_clustter_expression
2022-07-09 23:38:54.96: saving a table of each clustter's its average cell and average expression percentage of each gene
2022-07-09 23:38:55.04: finished avg_and_fraction_clustter_expression, results saved to: ./clusttered_data6/avg_clust_cells.csv and ./clusttered_data6/frac_clust_cells.csv
2022-07-09 23:38:55.10: starting pca_avg_clust_cells: original data shape is (454, 86) (we Transpose this in a moment)
Now PCA with 10. explain now is:
 [173.30290596 154.73838362 124.6585669   61.89915023  34.33849326
  26.11998723  23.80197192  20.27926707   6.82152568   6.52491454]
2022-07-09 23:38:55.13: finish PCA on the avg cells of each clustter. left with 10 values. current data shape is (86, 10) (Transposed). saved to ./clusttered_data6/PCA_avg_clust.csv
2022-07-09 23:38:55.13: starting linkage_on_clustters
2022-07-09 23:39:02.30: finished performing linkage_on_clustters, linkage output saved to: ./clusttered_data6/linkage_out.csv and the indeces given to clustters by the linkage saved to ./clusttered_data6/clust_idx_translation_table.csv
2022-07-09 23:39:02.30: #### finished linkage_pipeline ####
2022-07-09 23:39:02.30: #### starting heatmap_pipeline ####
2022-07-09 23:39:02.30: starting find_marker_genes: currently each clustter will have at most 8 unique markers
2022-07-09 23:39:02.45: finished find_marker_genes: returning a dictionary [keys - dbscan clustter idx, values - idx of marker genes]
2022-07-09 23:39:02.45: starting translate_and_sort_dict_keys
2022-07-09 23:39:02.46: finished translate_and_sort_dict_keys: returning a sorted(!) dictionary [keys - linkage(!) clustter idx, values - idx of marker genes]
2022-07-09 23:39:02.46: starting translate_clustter_data
2022-07-09 23:54:48.41: finished translate_clustter_data: translation table of clustter indeces saved to ./clusttered_data6/clust_tsne_data.csv
2022-07-09 23:54:49.75: starting sort_stack_data_by_clustter
2022-07-09 23:55:25.20: finished sort_stack_data_by_clustter: mapping each cell to its clustter linkage idx instead dbscan clustter idx 
2022-07-09 23:55:25.21: result of sort_stack_data_by_clustter saved to ./clusttered_data6/stacked_3_sort_by_clust.csv
2022-07-09 23:55:25.21: starting prepare_data_for_heatmap
/Users/shachar.katz/Documents/TechnionAAA/sem7/Bio/brains_v2/linkage_and_heatmap.py:238: DtypeWarning: Columns (0) have mixed types. Specify dtype option on import or set low_memory=False.
  df_stack_data = pd.read_csv(path_in_stack_data, index_col=0, header=0)
2022-07-09 23:55:51.08: finished prepare_data_for_heatmap: marker genes are order accoring to linkage clustters, gene expressions are normalized 
2022-07-09 23:55:51.08: result of prepare_data_for_heatmap saved to ./clusttered_data6/stacked_3_for_heatMap.csv
/Users/shachar.katz/Documents/TechnionAAA/sem7/Bio/brains_v2/linkage_and_heatmap.py:283: DtypeWarning: Columns (0) have mixed types. Specify dtype option on import or set low_memory=False.
  dict_cell_cluster = pd.read_csv(path_in_stack_data, index_col=0, header=0).T['linkage_labels']
2022-07-09 23:56:06.88: starting create_heatmap
2022-07-09 23:56:20.59: finished create_heatmap: result of create_heatmap saved to ./plots_folder1/part2
2022-07-09 23:56:20.60: #### finished heatmap_pipeline ####
2022-07-09 23:56:20.60: starting avg_and_fraction_clustter_expression
2022-07-10 00:15:44.73: saving a table of each clustter's its average cell and average expression percentage of each gene
2022-07-10 00:15:49.53: finished avg_and_fraction_clustter_expression, results saved to: ./clusttered_data6/avg_clust_cells_stk1.csv and ./clusttered_data6/frac_clust_cells_stk1.csv
2022-07-10 00:15:50.19: starting clustter_nueronal_genes: nueral gene expression on T-SNE's scatter plot
exclude marker gen id for Pdgfra is 8917
exclude marker gen id for Slc25a18 is 11202
exclude marker gen id for Olig1 is 24492
exclude marker gen id for Ly6c1 is 23232
exclude marker gen id for C1qb is 7892
exclude marker gen id for Cx3cr1 is 19009
exclude marker gen id for Vtn is 20135
exclude marker gen id for Foxj1 is 20936
exclude marker gen id for Pdgfrb is 26943
exclude marker gen id for Sox10 is 23362
exclude marker gen id for Ttr is 26600
exclude marker gen id for Gja1 is 14433
exclude marker gen id for Cldn5 is 23996
exclude marker gen id for Aqp4 is 26583
exclude marker gen id for Hba-a2 is 19331
exclude marker gen id for C1qc is 7893
exclude marker gen id for Hbb-bt is 13355
exclude marker gen id for Plxnb3 is 4554
exclude marker gen id for Olig2 is 24491
exclude marker gen id for C1qa is 7894
exclude marker gen id for Cldn11 is 5286
exclude marker gen id for Hbb-bs is 13356
exclude marker gen id for Acta2 is 27614
exclude marker gen id for Mfge8 is 12966
exclude marker gen id for Flt1 is 10037
(27998, 86)
gen id for Gad2 is 1868
gen id for Slc17a7 is 12665
gen id for Slc17a6 is 12788
2022-07-10 00:15:52.08: finished clustter_nueronal_genes {'Gaba': 12179, 'Glut1': 9933, 'Glut2': 8699, 'Non Nueronal': 3191, 'noise cluster': 2629, 'Doublets': 236}
2022-07-10 00:15:52.08: starting plot_nueral_gene_expression

2022-07-10 00:16:04.53: *********************************** Finish pipeline run ***********************************
Done

Process finished with exit code 0
